<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Escale.mobile.ViewModels"
             x:Class="Escale.mobile.Views.SubscriptionCustomerSearchPage"
             x:DataType="vm:SubscriptionCustomerSearchViewModel"
             Title="Credit Customer"
             BackgroundColor="#F8F9FA">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Label Text="CREDIT CUSTOMER"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="#1E3A8A"/>

            <Label Text="Enter the car plate number and PIN to verify the customer."
                   FontSize="14"
                   TextColor="#64748B"/>

            <!-- Plate Number -->
            <VerticalStackLayout Spacing="5">
                <Label Text="Plate Number"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#1E293B"/>
                <Border StrokeShape="RoundRectangle 10"
                        Stroke="#E2E8F0"
                        BackgroundColor="White"
                        Padding="15,10">
                    <Entry Placeholder="e.g., RAD 123 A"
                           Text="{Binding PlateNumber}"
                           FontSize="18"
                           TextColor="#1E293B"
                           CharacterSpacing="1"/>
                </Border>
            </VerticalStackLayout>

            <!-- Car PIN -->
            <VerticalStackLayout Spacing="5">
                <Label Text="Car PIN"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="#1E293B"/>
                <Border StrokeShape="RoundRectangle 10"
                        Stroke="#E2E8F0"
                        BackgroundColor="White"
                        Padding="15,10">
                    <Entry Placeholder="4-digit PIN"
                           Text="{Binding CarPIN}"
                           FontSize="18"
                           TextColor="#1E293B"
                           IsPassword="True"
                           Keyboard="Numeric"
                           MaxLength="4"/>
                </Border>
            </VerticalStackLayout>

            <!-- Verify Button -->
            <Grid HeightRequest="55">
                <Button Text="Verify Customer"
                        Command="{Binding SearchCommand}"
                        BackgroundColor="#1E3A8A"
                        TextColor="White"
                        FontSize="16"
                        FontAttributes="Bold"
                        HeightRequest="55"
                        CornerRadius="10"
                        IsVisible="{Binding IsSearching, Converter={StaticResource InvertedBoolConverter}}"/>

                <Border StrokeShape="RoundRectangle 10"
                        BackgroundColor="#3B5998"
                        HeightRequest="55"
                        IsVisible="{Binding IsSearching}">
                    <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="12">
                        <ActivityIndicator IsRunning="True"
                                         Color="White"
                                         HeightRequest="22"
                                         WidthRequest="22"/>
                        <Label Text="Verifying..."
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="White"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Border>
            </Grid>

            <!-- Error Message -->
            <Border StrokeShape="RoundRectangle 10"
                    BackgroundColor="#FEF2F2"
                    Padding="15"
                    IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}">
                <Label Text="{Binding ErrorMessage}"
                       FontSize="14"
                       TextColor="#DC2626"/>
            </Border>

            <!-- Result Card -->
            <Border StrokeShape="RoundRectangle 15"
                    BackgroundColor="White"
                    Padding="20"
                    StrokeThickness="2"
                    Stroke="#10B981"
                    IsVisible="{Binding HasResult}">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.1" Radius="10" Offset="0,2"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="12">
                    <!-- Customer Name -->
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Customer:"
                               FontSize="14"
                               TextColor="#64748B"
                               WidthRequest="100"/>
                        <Label Text="{Binding CustomerName}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#1E293B"/>
                    </HorizontalStackLayout>

                    <!-- Phone -->
                    <HorizontalStackLayout Spacing="10"
                                          IsVisible="{Binding CustomerPhone, Converter={StaticResource StringToBoolConverter}}">
                        <Label Text="Phone:"
                               FontSize="14"
                               TextColor="#64748B"
                               WidthRequest="100"/>
                        <Label Text="{Binding CustomerPhone}"
                               FontSize="14"
                               TextColor="#1E293B"/>
                    </HorizontalStackLayout>

                    <!-- Plate -->
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Plate:"
                               FontSize="14"
                               TextColor="#64748B"
                               WidthRequest="100"/>
                        <Label Text="{Binding ResultPlateNumber}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#1E3A8A"/>
                    </HorizontalStackLayout>

                    <!-- Vehicle -->
                    <HorizontalStackLayout Spacing="10"
                                          IsVisible="{Binding VehicleDescription, Converter={StaticResource StringToBoolConverter}}">
                        <Label Text="Vehicle:"
                               FontSize="14"
                               TextColor="#64748B"
                               WidthRequest="100"/>
                        <Label Text="{Binding VehicleDescription}"
                               FontSize="14"
                               TextColor="#1E293B"/>
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1" BackgroundColor="#E2E8F0" Margin="0,5"/>

                    <!-- Subscription Balance -->
                    <Border StrokeShape="RoundRectangle 10"
                            BackgroundColor="#F0FDF4"
                            Padding="15">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Subscription Balance"
                                   FontSize="12"
                                   TextColor="#64748B"/>
                            <Label Text="{Binding SubscriptionBalance, StringFormat='RWF {0:N0}'}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="#10B981"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Expiry -->
                    <HorizontalStackLayout Spacing="10"
                                          IsVisible="{Binding SubscriptionExpiry, Converter={StaticResource StringToBoolConverter}}">
                        <Label Text="Expires:"
                               FontSize="14"
                               TextColor="#64748B"
                               WidthRequest="100"/>
                        <Label Text="{Binding SubscriptionExpiry}"
                               FontSize="14"
                               TextColor="#F59E0B"/>
                    </HorizontalStackLayout>

                    <!-- Insufficient Balance Warning -->
                    <Border StrokeShape="RoundRectangle 8"
                            BackgroundColor="#FEF2F2"
                            Padding="10"
                            IsVisible="{Binding HasSufficientBalance, Converter={StaticResource InvertedBoolConverter}}">
                        <Label Text="Insufficient subscription balance for this sale."
                               FontSize="13"
                               TextColor="#DC2626"
                               HorizontalOptions="Center"/>
                    </Border>

                    <!-- Proceed Button -->
                    <Button Text="Proceed with Subscription"
                            Command="{Binding SelectCustomerCommand}"
                            BackgroundColor="#10B981"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="10"
                            Margin="0,5,0,0"/>
                </VerticalStackLayout>
            </Border>

            <!-- Cancel Button -->
            <Button Text="Cancel"
                    Command="{Binding CancelCommand}"
                    BackgroundColor="#E2E8F0"
                    TextColor="#475569"
                    FontSize="16"
                    HeightRequest="55"
                    CornerRadius="10"
                    Margin="0,10,0,0"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
