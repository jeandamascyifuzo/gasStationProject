<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Escale.mobile.ViewModels"
             xmlns:models="clr-namespace:Escale.mobile.Models"
             x:Class="Escale.mobile.Views.TransactionsPage"
             x:DataType="vm:TransactionsViewModel"
             Title="Transactions"
             BackgroundColor="#F8F9FA">

    <RefreshView Command="{Binding RefreshCommand}"
                 IsRefreshing="{Binding IsRefreshing}">
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20">

                <!-- Header -->
                <Label Text="TODAY'S TRANSACTIONS" 
                       FontSize="20" 
                       FontAttributes="Bold"
                       TextColor="#1E3A8A"/>

                <!-- Transactions List -->
                <CollectionView ItemsSource="{Binding Transactions}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Transaction">
                            <Border StrokeShape="RoundRectangle 15"
                                    BackgroundColor="White"
                                    Padding="15"
                                    Margin="0,0,0,10"
                                    StrokeThickness="0">
                                <Border.Shadow>
                                    <Shadow Brush="Black" Opacity="0.1" Radius="10" Offset="0,2"/>
                                </Border.Shadow>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TransactionsViewModel}}, Path=ViewDetailsCommand}"
                                        CommandParameter="{Binding .}"/>
                                </Border.GestureRecognizers>

                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <!-- Time and Fuel -->
                                    <HorizontalStackLayout Grid.Row="0" Spacing="10">
                                        <Label Text="{Binding TransactionDate, StringFormat='{0:HH:mm}'}" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#1E3A8A"/>
                                        <Label Text="-" 
                                               FontSize="14"
                                               TextColor="#64748B"/>
                                        <Label Text="{Binding FuelType}" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#1E293B"/>
                                        <Label Text="{Binding Liters, StringFormat='{0:F2} L'}" 
                                               FontSize="14"
                                               TextColor="#64748B"/>
                                    </HorizontalStackLayout>

                                    <!-- Amount and Payment -->
                                    <HorizontalStackLayout Grid.Row="1" Spacing="10">
                                        <Label Text="{Binding Total, StringFormat='RWF {0:N0}'}" 
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="#10B981"/>
                                        <Label Text="-" 
                                               FontSize="14"
                                               TextColor="#64748B"/>
                                        <Label Text="{Binding PaymentMethod}" 
                                               FontSize="14"
                                               TextColor="#64748B"/>
                                    </HorizontalStackLayout>

                                    <!-- Customer/Plate and EBM Status -->
                                    <HorizontalStackLayout Grid.Row="2" Spacing="10">
                                        <Label Text="{Binding PlateNumber}" 
                                               FontSize="12"
                                               TextColor="#64748B"
                                               IsVisible="{Binding PlateNumber, Converter={StaticResource StringToBoolConverter}}"/>
                                        <Label Text="{Binding CustomerName}" 
                                               FontSize="12"
                                               TextColor="#64748B"
                                               IsVisible="{Binding CustomerName, Converter={StaticResource StringToBoolConverter}}"/>
                                        <HorizontalStackLayout Spacing="5" HorizontalOptions="End">
                                            <Label Text="EBM:" 
                                                   FontSize="12"
                                                   TextColor="#64748B"/>
                                            <Label Text="? Sent" 
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="#10B981"
                                                   IsVisible="{Binding EBMSent}"/>
                                            <Label Text="? Pending" 
                                                   FontSize="12"
                                                   TextColor="#F59E0B"
                                                   IsVisible="{Binding EBMSent, Converter={StaticResource InvertedBoolConverter}}"/>
                                        </HorizontalStackLayout>
                                    </HorizontalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <VerticalStackLayout VerticalOptions="Center" Padding="40">
                            <Label Text="??" 
                                   FontSize="60"
                                   HorizontalOptions="Center"/>
                            <Label Text="No transactions yet today" 
                                   FontSize="16"
                                   TextColor="#64748B"
                                   HorizontalOptions="Center"
                                   Margin="0,20,0,0"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>

                <!-- Load More Button -->
                <Button Text="Load More"
                        Command="{Binding LoadMoreCommand}"
                        BackgroundColor="#E2E8F0"
                        TextColor="#475569"
                        FontSize="14"
                        HeightRequest="45"
                        CornerRadius="10"
                        IsVisible="{Binding Transactions.Count}"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>
